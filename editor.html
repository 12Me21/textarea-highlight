<!doctype html><meta charset=utf-8>
<meta name=viewport content="width=device-width, initial-scale=1, height=device-height">

<link rel=stylesheet href=style.css>
<script src=hl2.js></script>

<scroll-outer>
	<textarea-container id=$c>
		<textarea-overlay id=$o></textarea-overlay>
		<p class='textarea' contenteditable id=$i spellcheck=false>TEST&lt;div>HECK</p>
	</textarea-container>
</scroll-outer>

replaced nodes: <span id=$status></span>
<table>
	<tr> <th> parse/render: <td> <time id=$time1></time>ms
	<tr> <th> repaint: <td> <time id=$time2></time>ms
</table>

<script>
	let batch = (cb,w=0)=>e=>w++||requestAnimationFrame(_=>cb(e,w=0))
	
	function update() {
		render($i.innerText, $o)
	}
	
	fetch(location).then(x=>x.text()).then(x=>{
		$i.textContent = x
		update()
	})
	
	update()
	
	function draw_time(elem, time) {
		elem.textContent = time.toFixed(1)
	}
	
	$i.addEventListener('input', batch(e=>{
		let t0 = performance.now()
		update($i.value)
		let t1 = performance.now()
		$o.scrollHeight
		let t2 = performance.now()
		draw_time($time1, t1-t0)
		draw_time($time2, t2-t1)
	}), {passive: true})
</script>
